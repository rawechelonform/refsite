<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cursor — Pointer Lock</title>
<style>
  html,body{height:100%}
  body{margin:0; background:#000; color:#ddd; display:grid; place-items:center; font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
  .wrap{ text-align:center; max-width:720px; padding:0 16px }
  button{ margin:.5rem 0 }

  #custom-cursor{
    --size:34px; --thick:2px; --gap:18px; --dot:3px; --cursor-color:#fff;
    position:fixed; left:50%; top:50%; width:var(--size); height:var(--size);
    transform:translate(-50%,-50%); pointer-events:none; z-index:2147483647; color:var(--cursor-color);
  }
  #custom-cursor .arm{
    position:absolute; left:50%; top:50%; width:var(--size); height:var(--thick);
    transform-origin:50% 50%; transform:translate(-50%, -50%) rotate(45deg);
    background:linear-gradient(90deg,
      currentColor 0 calc(50% - (var(--gap)/2)),
      transparent  calc(50% - (var(--gap)/2)) calc(50% + (var(--gap)/2)),
      currentColor calc(50% + (var(--gap)/2)) 100%);
  }
  #custom-cursor .arm-b{ transform:translate(-50%,-50%) rotate(-45deg); }
  #custom-cursor .dot{
    position:absolute; left:50%; top:50%; width:var(--dot); height:var(--dot);
    transform:translate(-50%,-50%); border-radius:50%; background:currentColor;
  }

  @keyframes cursor-spin{ from{transform:translate(-50%,-50%) rotate(0)} to{transform:translate(-50%,-50%) rotate(360deg)} }
</style>
</head>
<body>
  <div id="custom-cursor" aria-hidden="true">
    <span class="arm arm-a"></span>
    <span class="arm arm-b"></span>
    <span class="dot"></span>
  </div>
  <div class="wrap">
    <h1>Pointer Lock Test</h1>
    <p>Click “Lock Pointer”. While locked, the OS cursor is hidden; the crosshair stays centered and we move it by <code>movementX/Y</code>. Press <b>Esc</b> to exit.</p>
    <button id="lockBtn">Lock Pointer</button>
    <div><small id="status"></small></div>
  </div>

  <script>
  (() => {
    const cursor = document.getElementById('custom-cursor');
    const btn = document.getElementById('lockBtn');
    const status = document.getElementById('status');

    let angle = 0;
    const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;

    function spin(){
      if (reduce) return;
      const reverse = Math.random() < 0.5;
      cursor.style.animation='none';
      void cursor.offsetWidth;
      cursor.style.animation = `cursor-spin 360ms ease-out ${reverse?'reverse':'normal'}`;
    }

    // While locked, we “fake” movement by rotating or nudging if you prefer.
    function onMouseMove(e){
      // e.movementX/Y available only during pointer lock (and some desktop states)
      angle += e.movementX * 0.15;
      cursor.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;
    }

    btn.addEventListener('click', async () => {
      const el = document.documentElement;
      try {
        el.requestPointerLock = el.requestPointerLock || el.webkitRequestPointerLock;
        document.exitPointerLock = document.exitPointerLock || document.webkitExitPointerLock;
        if (!el.requestPointerLock) {
          status.textContent = 'Pointer Lock not supported here.';
          return;
        }
        el.requestPointerLock();
      } catch {
        status.textContent = 'Pointer Lock request failed.';
      }
    });

    document.addEventListener('pointerdown', () => spin());
    document.addEventListener('mousemove', onMouseMove);

    document.addEventListener('pointerlockchange', () => {
      const locked = document.pointerLockElement === document.documentElement;
      status.textContent = locked ? 'Locked (Esc to exit)' : 'Unlocked';
      if (!locked) {
        // reset transform when leaving lock
        cursor.style.transform = `translate(-50%, -50%)`;
      }
    });
  })();
  </script>
</body>
</html>
