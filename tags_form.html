<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TAG THE WALL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- DotGothic16 -->
  <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#000;
      --crt:#00ff00;
      --crt-dim: rgba(0,255,0,.55);

      /* typography (single size) */
      --fs:20px;
      --ls:.08em;
      --lh:1.3;                  /* unitless; used for vertical math */

      /* layout */
      --stage-offset:56px;       /* push canvas down */
      --wrap-w:96vw;             /* let text run wide */
      --max-w:1600px;
      --left-offset: 1in;        /* scooch block ~1 inch to the right */
      --sep-title:24px;          /* extra space under header */
      --between-q:18px;          /* extra row between questions */
      --row-gap:12px;            /* label→input spacing */

      /* caret + input spacing */
      --caret-gap:1ch;

      /* buttons */
      --btn-w: 240px;            /* wider so UPLOAD IMAGE stays on one line */
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; }
    body{
      background:var(--bg);
      color:var(--crt);
      font-family:'DotGothic16', system-ui, monospace;
      text-transform:uppercase;
      letter-spacing:var(--ls);
      font-size:var(--fs);
      line-height:calc(var(--lh) * 1em);
    }

    .wrap{
  width: var(--wrap-w);
  max-width: var(--max-w);
  margin: calc(var(--stage-offset)) auto 32px;
  padding: 0 calc(12px + var(--left-offset));
}


    /* BACK button: align with header top, inset from the right
       by the SAME amount we inset content from the left */
.back-btn{
  position: fixed;
  top: calc(var(--stage-offset));           /* align vertically with header */
  right: calc(12px + var(--left-offset));   /* same margin distance as wrap’s left padding */
  z-index: 10;
  background: transparent;                  /* no box */
  color: var(--crt);
  border: 0;
  padding: 0;
  font: inherit;
  font-weight: 700;
  cursor: pointer;
  user-select: none;
}
.back-btn:hover{
  text-decoration: underline;               /* subtle hover effect */
}


    /* header */
    h1{
      margin:0;
      font-weight:700;
      font-size:var(--fs);
      line-height:calc(var(--lh)*1em);
      text-align:left;
    }
    .spacer-title{ height: var(--sep-title); } /* EXTRA space under header */

    /* section labels (questions) */
    .q{
      margin-top: var(--between-q);      /* EXTRA row between questions */
    }

    /* input line: caret + typed are baseline-aligned with flex */
    .line{
      display:flex;
      align-items: baseline;             /* <— aligns “>”, text, and cursor */
      gap: var(--caret-gap);
      margin-top: var(--row-gap);
      margin-bottom: var(--between-q);   /* EXTRA space after each input row */
    }

    /* when there should be no caret (upload/go rows) */
    .no-caret .caret{ display:none; }

    .caret{
      flex: 0 0 auto;
      line-height: calc(var(--lh) * 1em);
      /* tiny optical tweak so “>” sits perfectly on the text baseline */
      transform: translateY(calc((var(--lh) - 1) * 0.5em - 0.02em));
    }

    .typed{
      flex: 1 1 auto;
      white-space: pre-wrap;
      min-height: calc(var(--lh) * 1em);
      line-height: calc(var(--lh) * 1em);
      color: var(--crt);
    }
    .typed.ph{ color: var(--crt-dim); }  /* dimmer green for placeholder */

    /* single block cursor that moves to active field, hidden by default */
    .cursor-block{
      display:inline-block;
      width:1.1ch;
      height:1em;
      background:var(--crt);
      color:#000;
      /* blink and sit on baseline */
      transform: translateY(calc((var(--lh) - 1) * 0.5em));
      animation: cursorBlink .8s steps(1,end) infinite;
      vertical-align: baseline;
    }
    @keyframes cursorBlink{
      0%,45%   { background:var(--crt); color:#000; }
      50%,100% { background:transparent; color:transparent; }
    }

    /* hidden real inputs store lowercase value */
    .hid-input{
      position:absolute !important;
      left:-9999px !important;
      width:1px; height:1px;
      opacity:0; border:0; outline:none;
      background:transparent; color:transparent;
      caret-color:transparent;
      pointer-events:none;
      text-transform:lowercase;
    }

    /* buttons: flush-left with everything else */
    .btn{
      display:inline-block;
      width:var(--btn-w);
      padding:10px 14px;
      background:var(--bg);
      color:var(--crt);
      border:1px solid var(--crt);
      border-radius:0;
      font: inherit;
      font-weight:700;
      text-align:center;
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{ filter:brightness(1.05); }
    .btn:disabled{ opacity:.55; cursor:not-allowed; }

    input[type="file"]{ display:none; }

    /* inline status to the RIGHT of the GO button */
    .status{
      display:inline-block;
      margin-left: 14px;
      font-style: italic;
      white-space: nowrap;
      vertical-align: baseline;
    }
    .status.ok{ color:#7cfc00; }
    .status.err{ color:#ff6b6b; }

    .hidden{ display:none; }

    /* honeypot */
    .hp{ position:absolute; left:-9999px; top:-9999px; }
  </style>
</head>
<body>
  <!-- Top-right BACK (no box) -->
  <button class="back-btn" onclick="location.href='bathroom.html'">&lt;BACK&gt;</button>

  <div class="wrap">
    <h1>TAG THE WALL</h1>
    <div class="spacer-title"></div>

    <form id="tags_form" novalidate method="POST" enctype="multipart/form-data"
      action="https://script.google.com/macros/s/AKfycbxv3FKB0P30wixxKJUfYvTnCW9vzqgar4JV7PArIpirC9lk7Srpqe3SNDKIcCIvjs_4/exec"
      target="hidden_iframe">

      <!-- UPLOAD -->
      <div class="q">UPLOAD IMAGE</div>
      <div class="line no-caret">
        <span class="caret">&gt;</span>
        <label for="sticker" class="btn">UPLOAD IMAGE</label>
        <input id="sticker" type="file" name="sticker" accept=".png,.jpg,.jpeg,.webp" required />
      </div>

      <!-- PLACE OF TAG -->
      <div class="q">PLACE OF TAG</div>
      <div class="line" data-field="title" data-ph="'ZËRGË COFFEESHOP', 'BERLIN WALL', 'STRIPPER POLE' (LEAVE BLANK IF UNKNOWN)">
        <span class="caret">&gt;</span>
        <div class="typed" id="typed-title"></div>
        <input id="hid-title" class="hid-input" type="text" name="title" maxlength="30"
               autocomplete="off" autocapitalize="off" spellcheck="false">
      </div>

      <!-- CITY -->
      <div class="q">CITY</div>
      <div class="line" data-field="city" data-ph="NEW YORK CITY">
        <span class="caret">&gt;</span>
        <div class="typed" id="typed-city"></div>
        <input id="hid-city" class="hid-input" type="text" name="city" maxlength="30"
               autocomplete="address-level2" autocapitalize="off" spellcheck="false">
      </div>

      <!-- COUNTRY -->
      <div class="q">COUNTRY</div>
      <div class="line" data-field="country" data-ph="NEW YORK">
        <span class="caret">&gt;</span>
        <div class="typed" id="typed-country"></div>
        <input id="hid-country" class="hid-input" type="text" name="country" maxlength="30"
               autocomplete="country-name" autocapitalize="off" spellcheck="false">
      </div>

      <!-- Honeypot -->
      <input class="hp" type="text" name="website" tabindex="-1" autocomplete="off" />

      <!-- GO + inline status -->
      <div class="line no-caret">
        <span class="caret">&gt;</span>
        <button id="submitBtn" type="submit" class="btn">&lt;GO&gt;</button>
        <span id="status" class="status"></span>
      </div>

      <!-- hidden iframe target for Apps Script response -->
      <iframe name="hidden_iframe" class="hidden"></iframe>

      <!-- one global cursor; hidden until focus/typing -->
      <span id="cursor" class="cursor-block" aria-hidden="true" style="display:none;"></span>
    </form>
  </div>

  <script>
    // --- single moving block-cursor ---
    const cursorEl = document.getElementById('cursor');

    function attachCursorTo(typedEl){
      if (!typedEl) return;
      typedEl.appendChild(cursorEl);
      cursorEl.style.display = '';
    }
    function hideCursor(){
      cursorEl.style.display = 'none';
      document.body.appendChild(cursorEl);
    }

    // --- terminal-like binding per field ---
    function bindTermField(field){
      const line  = document.querySelector(`.line[data-field="${field}"]`);
      if (!line) return;
      const typed = line.querySelector('.typed');
      const input = document.getElementById(`hid-${field}`);
      const ph    = line.getAttribute('data-ph') || '';

      // focus when clicking anywhere on the line
      line.addEventListener('click', ()=> input.focus());

      function render(showPh=true){
        const v = input.value || '';
        if (!v && showPh){
          typed.textContent = ph;          // placeholder
          typed.classList.add('ph');       // dimmer color
        } else {
          typed.textContent = v.toUpperCase();
          typed.classList.remove('ph');
        }
      }

      input.addEventListener('focus', ()=>{
        render(false);                     // clear placeholder
        attachCursorTo(typed);
      });

      input.addEventListener('input', ()=>{
        input.value = (input.value || '').toLowerCase().slice(0, 30);
        render(false);
        attachCursorTo(typed);
      });

      input.addEventListener('blur', ()=>{
        hideCursor();
        if (!input.value) render(true);    // restore placeholder if empty
      });

      // initial paint (placeholder visible, no cursor)
      render(true);
    }

    ['title','city','country'].forEach(bindTermField);

    // --- validation + inline status + submit ---
    const form = document.getElementById('tags_form');
    const btn  = document.getElementById('submitBtn');
    const status = document.getElementById('status');
    const fileInput = document.getElementById('sticker');

    function setStatusOk(msg){
      status.className = 'status ok';
      status.textContent = msg;
    }
    function setStatusErr(msg){
      status.className = 'status err';
      status.textContent = msg;
    }
    function clearStatus(){ status.className = 'status'; status.textContent = ''; }

    form.addEventListener('submit', (event)=>{
      clearStatus();

      const file = fileInput.files && fileInput.files[0];
      if (!file){
        event.preventDefault();
        setStatusErr('no image uploaded.');
        return;
      }
      const okType = ['image/png','image/jpeg','image/webp'].includes(file.type);
      if (!okType){
        event.preventDefault();
        setStatusErr('PNG/JPEG/WEBP ONLY');
        return;
      }
      if (file.size > 10*1024*1024){
        event.preventDefault();
        setStatusErr('FILE TOO LARGE (MAX 10MB)');
        return;
      }

      // final lowercase & 30-char cap
      ['hid-title','hid-city','hid-country'].forEach(id=>{
        const el = document.getElementById(id);
        if (el) el.value = (el.value||'').toLowerCase().slice(0,30);
      });

      btn.disabled = true;
      btn.textContent = '<GO>';
    });

    // success handler (when Apps Script returns into the hidden iframe)
    document.querySelector('iframe[name="hidden_iframe"]').addEventListener('load', ()=>{
      btn.disabled = false;
      btn.textContent = '<GO>';
      setStatusOk('TAG SUBMITTED. IT MAY TAKE A FEW DAYS FOR TAG TO APPEAR ON WALL.');
      // (Optional) reset fields and placeholders:
      // document.getElementById('tags_form').reset();
      // hideCursor();
      // ['title','city','country'].forEach(f=>{
      //   const input = document.getElementById(`hid-${f}`);
      //   if (input) input.dispatchEvent(new Event('blur'));
      // });
    });
  </script>
</body>
</html>
